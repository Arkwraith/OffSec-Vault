---
tags:
  - vulnerability
  - cve
severity:
  - High
Vulnerability Category:
  - Remote Code Execution
CVE: CVE-2022-22965
CWE: CWE-20
OS: Linux
---
# Brief
Spring4Shell (CVE-2022-22965) is a remote code execution (RCE) vulnerability in the Spring Core framework for Java. Allows attackers to upload and execute a webshell by abusing HTTP parameter binding, resulting in remote command execution on affected servers.

---
# Overview
Spring4Shell emerged in March 2022 as an 0-day affecting Spring Core, the heart of the Spring Framework. It was quickly identified as a bypass for the patch to CVE-2010-1622, reviving an old class of vulnerabilities in how Spring handles HTTP request data binding. Attackers can exploit this flaw to upload a malicious `.jsp` webshell, which is then executed by Apache Tomcat, granting full RCE.

Affected versions:
- Spring Framework: < 5.2, 5.2.0-19, 5.3.0-17
- JDK: 9 or higher
- Apache Tomcat deployed as WAR
- Application uses `spring-webmvc` and/or `spring-webflux`

Exploitation requires a specific set of conditions, but the widespread use of Spring means many systems may be at risk.

---
# Signals
- Spring Framework version is vulnerable (`<5.2`, `5.2.0-19`, `5.3.0-17`)
- JDK version is 9 or greater (`java -version`)
- Deployed on Apache Tomcat as a WAR
- Application depends on `spring-webmvc` or `spring-webflux`
- Writable web root or directory
- Can enumerate with:
    - [linpeas](Tools/linpeas) -> finds Tomcat, Spring version
    - Manual review of `pom.xml` or build.gradle for dependencies
    - [curl](Tools/curl) -> test for upload/execution

---
# Exploitation

## Method
1. **Obtain Exploit**
    - Download PoC (e.g., `exploit.py` from [exploit-db](Tools/exploitdb) or provided archive)
2. **Identify Target URL**
    - Inspect the web app for a POST endpoint (e.g., via contact form, usually `/`)
3. **Upload Webshell**
    - Run exploit:
      ```
      ./exploit.py http://TARGET_IP/
      ```
    - Default uploads `tomcatwar.jsp` webshell to root directory
4. **Access Webshell**
    - Navigate to:
      ```
      http://TARGET_IP/tomcatwar.jsp?pwd=thm&cmd=whoami
      ```
    - Change `cmd` to run arbitrary commands (e.g., `id`, `ls`, etc.)

## Under the Hood
- Exploit abuses HTTP parameter binding to overwrite critical properties (like `class.module.classLoader`) in the Spring application, allowing arbitrary file write.
- The attacker uploads a `.jsp` file containing a webshell.
- Apache Tomcat executes the webshell, enabling remote commands via HTTP GET/POST.

## Alternate Detection
- Manual code/config review for vulnerable Spring/JDK/Tomcat versions
- Attempt webshell upload and execution
- Analysis of HTTP logs for suspicious POST requests

---
# Pattern
- **Vulnerability Class:** Improper Input Validation (`CWE-20`)
- **Privilege Escalation Vector:** Overwriting class attributes via crafted HTTP POST
- **Trigger Mechanism:** Malicious request with parameters targeting vulnerable endpoints
- **Exploit Mechanism:** Write and execute `.jsp` webshell for RCE

## Related Techniques
- [Webshell Upload](Techniques/Webshell Upload)
- [HTTP Parameter Pollution](Techniques/HTTP Parameter Pollution)
- [JSP Abuse](Techniques/JSP Abuse)
- [WAR Package Exploitation](Techniques/WAR Exploitation)

---
# Tools
- [curl](Tools/curl) -> Send crafted requests or interact with webshell
- [exploit-db](Tools/exploitdb) -> Search for public PoCs
- [linpeas](Tools/linpeas) -> Enumeration of Spring/Tomcat/JDK versions

- Github-hosted PoCs:
    - [Spring4Shell-POC](https://github.com/twseptian/Spring4Shell-POC)
    - [Spring4Shell-exploit](https://github.com/reznok/Spring4Shell-Exploit)
    - [dustyfresh/Spring4Shell-poc](https://github.com/dustyfresh/Spring4Shell-poc)

---
# Mitigation

## Permanent Fix
- Upgrade Spring Framework to:
    - 5.2.20+ (if using 5.2.x)
    - 5.3.18+ (if using 5.3.x)
- Patch JDK and Tomcat as needed
- Apply official Spring security advisories

## Temporary Workaround
- Apply blocklist for vulnerable field patterns as recommended by Spring
- Restrict file upload and HTTP parameter binding
- Limit writable directories and remove unnecessary privileges

## Verify
- Attempt exploit; if webshell upload fails, system is likely patched
- Confirm Spring version is >= 5.2.20 or >= 5.3.18
- Check application dependencies for safe versions

---
# References
- [Spring Security RCE Announcement](https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement)
- [LunaSec Blog Post](https://www.lunasec.io/docs/blog/spring-rce-vulnerabilities/)
- [Praetorian Blog Post](https://www.praetorian.com/blog/spring4shell-explained/)
- [o0o Writeup for CVE-2010-1622](https://github.com/o0o0oo0oo/CVE-2010-1622)
- [PayloadsAllTheThings â€“ Spring4Shell](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Java%20-%20Spring%20Core%20RCE)

---
# Notes
- Exploit requires specific deployment conditions (JDK 9+, WAR on Tomcat, vulnerable Spring version)
- Webshell upload only works once per server startup; restart required to re-exploit if misconfigured
- Impact may evolve as new attack vectors are discovered
- Always review exploit code before running; public PoCs may contain malicious payloads

---
# Related CTFs

